# TTS 500 错误修复指南

## 问题描述
英文单词使用中文 TTS 参数（`lang=zh`），导致有道 API 返回 500 错误。

## 解决步骤

### 1. 清除浏览器缓存
1. 打开浏览器开发者工具（F12 或 Cmd+Option+I）
2. 打开 Application 标签
3. 在左侧找到 "Local Storage"
4. 删除以下键（如果存在）：
   - `settings`
   - `targetLang`
   - 任何与语言相关的键

### 2. 清空缓存并硬性重新加载
1. 右键点击浏览器刷新按钮
2. 选择"清空缓存并硬性重新加载"

### 3. 重启服务器
```bash
# 停止当前服务器（Ctrl+C）
# 然后重新启动
python3 run.py
```

### 4. 使用无痕模式测试
打开新的无痕窗口（Cmd+Shift+N），访问 http://127.0.0.1:5001

### 5. 验证设置
1. 登录后，检查界面上的"翻译"下拉框
2. 确保选择的是"中文"（这是翻译语言，不是单词语言）
3. 输入英文单词时，系统应该自动检测为英语

## 预期行为
- 输入英文单词 → 自动检测为 `en` → TTS 使用 `lang=en`
- 输入日文单词 → 自动检测为 `ja` → TTS 使用 `lang=ja`
- 输入中文单词 → 自动检测为 `zh` → TTS 使用 `lang=zh`

## 如果问题仍然存在
请在浏览器控制台运行以下代码检查当前状态：
```javascript
console.log('Target Lang:', localStorage.getItem('settings'));
```

然后将输出发送给我。
