<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³é¢‘ä¼˜åŒ–æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
        }
        .log {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
        }
        .log-success {
            color: #22c55e;
        }
        .log-error {
            color: #ef4444;
        }
        .log-info {
            color: #3b82f6;
        }
        select, input[type="radio"] {
            margin: 5px;
        }
        label {
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ éŸ³é¢‘åŠ è½½ä¼˜åŒ–æµ‹è¯•</h1>

        <div class="test-section">
            <h3>æµ‹è¯• 1: playbackRate æ…¢é€Ÿæ’­æ”¾</h3>
            <p>æµ‹è¯•ä½¿ç”¨ playbackRate å®ç°æ…¢é€Ÿæ’­æ”¾ï¼ˆä¸é¢„åŠ è½½æ…¢é€ŸéŸ³é¢‘ï¼‰</p>
            <button onclick="testPlaybackRate('hello', false)">æ’­æ”¾æ­£å¸¸é€Ÿåº¦ (hello)</button>
            <button onclick="testPlaybackRate('hello', true)">æ’­æ”¾æ…¢é€Ÿ 0.75x (hello)</button>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯• 2: å£éŸ³åˆ‡æ¢ï¼ˆä»…è‹±è¯­ï¼‰</h3>
            <p>æµ‹è¯•åªé¢„åŠ è½½å½“å‰é€‰æ‹©çš„å£éŸ³</p>
            <label><input type="radio" name="accent" value="us" checked> US</label>
            <label><input type="radio" name="accent" value="uk"> UK</label>
            <br>
            <button onclick="testAccent('world')">æ’­æ”¾ worldï¼ˆå½“å‰å£éŸ³ï¼‰</button>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯• 3: å¤šè¯­è¨€æµ‹è¯•</h3>
            <p>æµ‹è¯•å…¶ä»–è¯­è¨€åªåŠ è½½ä¸€ä¸ªéŸ³é¢‘</p>
            <button onclick="testMultiLang('ã“ã‚“ã«ã¡ã¯', 'ja')">æ—¥è¯­: ã“ã‚“ã«ã¡ã¯</button>
            <button onclick="testMultiLang('ì•ˆë…•í•˜ì„¸ìš”', 'ko')">éŸ©è¯­: ì•ˆë…•í•˜ì„¸ìš”</button>
            <button onclick="testMultiLang('ä½ å¥½', 'zh')">ä¸­æ–‡: ä½ å¥½</button>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯• 4: æœåŠ¡å™¨ç¼“å­˜</h3>
            <p>ç¬¬äºŒæ¬¡è¯·æ±‚åº”è¯¥ä»ç¼“å­˜è¿”å›ï¼ˆæŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼‰</p>
            <button onclick="testCache('apple')">ç¬¬ä¸€æ¬¡è¯·æ±‚ apple</button>
            <button onclick="testCache('apple')">ç¬¬äºŒæ¬¡è¯·æ±‚ appleï¼ˆåº”è¯¥å‘½ä¸­ç¼“å­˜ï¼‰</button>
        </div>

        <div class="log" id="log"></div>
    </div>

    <script>
        let currentAudio = null;
        const API_BASE = 'http://127.0.0.1:5001';

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        async function testPlaybackRate(word, slow) {
            try {
                log(`æµ‹è¯• playbackRate: ${word}, slow=${slow}`, 'info');

                const url = `${API_BASE}/api/tts?word=${encodeURIComponent(word)}&accent=us&lang=en`;
                log(`è¯·æ±‚ URL: ${url}`, 'info');

                const res = await fetch(url);
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}`);
                }

                const blob = await res.blob();
                const blobUrl = URL.createObjectURL(blob);

                if (currentAudio) {
                    currentAudio.pause();
                }

                currentAudio = new Audio(blobUrl);
                currentAudio.playbackRate = slow ? 0.75 : 1.0;

                log(`âœ“ æ’­æ”¾é€Ÿåº¦è®¾ç½®ä¸º: ${currentAudio.playbackRate}x`, 'success');

                await currentAudio.play();
                log(`âœ“ å¼€å§‹æ’­æ”¾`, 'success');

            } catch (e) {
                log(`âœ— é”™è¯¯: ${e.message}`, 'error');
            }
        }

        async function testAccent(word) {
            try {
                const accent = document.querySelector('input[name="accent"]:checked').value;
                log(`æµ‹è¯•å£éŸ³: ${word}, accent=${accent}`, 'info');

                const url = `${API_BASE}/api/tts?word=${encodeURIComponent(word)}&accent=${accent}&lang=en`;
                log(`è¯·æ±‚ URL: ${url}`, 'info');

                const res = await fetch(url);
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}`);
                }

                const blob = await res.blob();
                const blobUrl = URL.createObjectURL(blob);

                if (currentAudio) {
                    currentAudio.pause();
                }

                currentAudio = new Audio(blobUrl);
                await currentAudio.play();

                log(`âœ“ æ’­æ”¾æˆåŠŸ (${accent} å£éŸ³)`, 'success');

            } catch (e) {
                log(`âœ— é”™è¯¯: ${e.message}`, 'error');
            }
        }

        async function testMultiLang(word, lang) {
            try {
                log(`æµ‹è¯•å¤šè¯­è¨€: ${word}, lang=${lang}`, 'info');

                const url = `${API_BASE}/api/tts?word=${encodeURIComponent(word)}&accent=us&lang=${lang}`;
                log(`è¯·æ±‚ URL: ${url}`, 'info');

                const res = await fetch(url);
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}`);
                }

                const blob = await res.blob();
                const blobUrl = URL.createObjectURL(blob);

                if (currentAudio) {
                    currentAudio.pause();
                }

                currentAudio = new Audio(blobUrl);
                await currentAudio.play();

                log(`âœ“ æ’­æ”¾æˆåŠŸ (${lang})`, 'success');

            } catch (e) {
                log(`âœ— é”™è¯¯: ${e.message}`, 'error');
            }
        }

        async function testCache(word) {
            try {
                const startTime = Date.now();
                log(`æµ‹è¯•ç¼“å­˜: ${word}`, 'info');

                const url = `${API_BASE}/api/tts?word=${encodeURIComponent(word)}&accent=us&lang=en`;

                const res = await fetch(url);
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}`);
                }

                const blob = await res.blob();
                const duration = Date.now() - startTime;

                log(`âœ“ è¯·æ±‚å®Œæˆï¼Œè€—æ—¶: ${duration}ms (æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ç¡®è®¤æ˜¯å¦å‘½ä¸­ç¼“å­˜)`, 'success');

                const blobUrl = URL.createObjectURL(blob);
                if (currentAudio) {
                    currentAudio.pause();
                }
                currentAudio = new Audio(blobUrl);
                await currentAudio.play();

            } catch (e) {
                log(`âœ— é”™è¯¯: ${e.message}`, 'error');
            }
        }

        log('æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œå‡†å¤‡å¼€å§‹æµ‹è¯•', 'success');
    </script>
</body>
</html>
