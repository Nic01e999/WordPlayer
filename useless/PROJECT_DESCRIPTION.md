# 项目描述：多语言学习工具

## 一、项目概述

本项目是一个基于 Web 的交互式多语言学习工具，旨在帮助学习者通过**听写训练**和**循环复读**两种模式，高效掌握外语词汇。系统支持英语、日语、韩语、法语和中文五种语言，提供了完整的词汇管理、语音合成、智能翻译和数据同步功能。

项目采用前后端分离架构，以现代化的"液态玻璃"设计风格呈现，提供流畅、美观的用户体验。

---

## 二、项目背景与目标

### 背景
传统的语言学习工具往往功能单一，要么只提供词汇记忆，要么只支持听写测试，缺乏系统性和灵活性。学习者需要在多个应用之间切换，无法形成完整的学习闭环。

### 目标
- **打造一体化学习平台**：集词汇管理、听写训练、循环复读于一体
- **支持多语言学习**：满足学习者学习多种语言的需求
- **提升学习效率**：通过智能缓存、预加载等技术优化用户体验
- **实现跨设备同步**：支持多设备数据实时同步，随时随地学习

---

## 三、主要功能

### 3.1 词汇管理系统
- **单词表创建与编辑**：支持创建多个单词表，可自定义名称和颜色
- **文件夹组织**：将单词表分类到不同文件夹，支持拖拽排序
- **词典翻译**：输入单词后自动获取释义、例句
- **灵活输入格式**：支持 `word:definition` 格式直接定义单词释义

### 3.2 Repeater Mode（复读模式）
- **自动循环播放**：按照设定的间隔自动播放单词和翻译
- **多语音选项**：
  - 英语支持美式/英式发音，每种发音有正常/慢速两种速度
  - 其他语言支持正常/慢速两种速度
- **可视化进度**：显示当前播放进度，支持手动跳转
- **键盘快捷键**：支持空格暂停/播放，左右方向键切换单词

### 3.3 Dictation Mode（听写模式）
- **听力测试**：播放单词发音，学习者输入拼写
- **即时反馈**：实时判断正误，错误时高亮显示差异
- **统计分析**：记录正确率，帮助学习者了解掌握情况

### 3.4 用户认证与同步
- **账号系统**：支持用户注册、登录、密码找回
- **云端同步**：单词表、布局、设置自动同步到云端
- **多设备支持**：通过 WebSocket 实现多设备实时同步
- **邮件服务**：集成密码重置邮件功能

### 3.5 主题系统
- **8 套主题**：提供 Pink/Green/Blue/Purple 四种配色，各有 Light/Dark 模式
- **液态玻璃设计**：半透明玻璃效果 + 背景模糊 + 流畅动画
- **响应式布局**：完美适配桌面端

---

## 四、技术架构

### 4.1 后端架构（Python Flask）

```
server/
├── app.py           # Flask 主应用，WebSocket 服务
├── auth.py          # 用户认证 API（注册/登录/忘记密码）
├── sync.py          # 数据同步 API（单词表/布局）
├── settings.py      # 用户设置 API
├── dict_api.py      # DeepSeek AI 单词信息 API
├── tts.py           # 有道 TTS 语音合成 API
├── db.py            # SQLite 数据库连接和初始化
├── cache.py         # 单词缓存系统（LRU 淘汰）
├── email_service.py # 邮件服务（密码重置）
└── middleware.py    # 认证中间件
```

**核心 API 端点**：
- `/api/auth/*` - 用户认证
- `/api/wordinfo/batch` - 批量获取单词信息
- `/api/tts` - 文本转语音
- `/api/sync/*` - 数据同步
- `/api/settings` - 用户设置管理

### 4.2 前端架构（ES Modules）

```
js/
├── app.js        # 应用入口
├── api.js        # API 调用封装
├── audio.js      # 音频播放管理
├── state.js      # 全局状态管理
├── preload.js    # 后台预加载系统
├── storage/      # localStorage 缓存管理
├── i18n/         # 国际化系统（中英日韩法五种语言）
├── auth/         # 认证模块
├── sync/         # 同步模块
├── wordlist/     # 单词表管理（拖拽、文件夹、渲染）
├── repeater/     # 复读模式（播放逻辑、键盘导航、滑块控制）
└── dictation/    # 听写模式（测验逻辑、拖拽弹窗）
```

### 4.3 数据流：四级缓存系统

```
Level 1: 内存缓存 (preloadCache)
    ↓ 未命中
Level 2: localStorage (按语言分开，最多 500 个/语言)
    ↓ 未命中
Level 3: 服务端缓存 (JSON 文件，最多 5000 个/语言)
    ↓ 未命中
Level 4: 第三方 API (DeepSeek AI / 有道翻译)
```

这种多级缓存架构大幅减少了 API 调用次数，降低了成本，提升了响应速度。

---

## 五、技术亮点与创新点

### 5.1 异步竞态控制
- **playId 机制**：每次开始播放时递增 playId，播放函数检查 ID 一致性，防止模式切换时的异步竞态问题
- **AbortController**：取消未完成的 fetch 请求
- **loadId 机制**：取消过时的预加载任务

### 5.2 循环依赖解决
采用**延迟绑定（Lazy Binding）**模式解决前端模块间的循环依赖：
- `repeater` 和 `dictation` 模块相互依赖
- 使用 `setRenderDeps`、`setDragDeps` 等函数在运行时注入依赖
- 保持代码模块化的同时避免了循环引用问题

### 5.3 智能预加载系统
- **防抖优化**：输入完成 500ms 后才开始预加载，避免频繁请求
- **并发控制**：限制音频加载并发数为 6，防止浏览器请求阻塞
- **进度可视化**：实时显示预加载进度，提升用户体验

### 5.4 性能优化
- **LRU 淘汰策略**：缓存满时自动淘汰最久未使用的数据
- **Blob URL 管理**：及时释放音频 Blob URL，防止内存泄漏
- **懒加载**：按需加载模块和资源
- **防抖节流**：优化输入和滚动事件处理

### 5.5 多语言自动检测
系统自动识别输入文字的语言类型，无需手动切换，支持：
- 英语、日语、韩语、法语、中文
- 自动过滤无效字符
- 智能选择对应的 TTS 语音引擎

---

## 六、技术栈

### 后端
- **语言**：Python 3
- **框架**：Flask
- **数据库**：SQLite
- **WebSocket**：Flask-SocketIO
- **外部 API**：
  - 有道翻译 API（多语言翻译）
  - 有道 TTS API（语音合成）

### 前端
- **语言**：JavaScript (ES6+ Modules)
- **样式**：纯 CSS（无框架，自定义液态玻璃风格）
- **音频**：Web Audio API / HTML5 Audio
- **存储**：localStorage、IndexedDB
- **实时通信**：WebSocket

### 开发工具
- **版本控制**：Git
- **部署**：可通过 rsync 或 tar 包部署到服务器

---

## 七、项目特色

1. **一站式学习体验**：词汇管理、听写、复读三大功能无缝集成
2. **极致性能优化**：四级缓存 + 智能预加载，响应速度快
3. **精美的用户界面**：液态玻璃设计风格，提供 8 套主题，视觉体验出色
4. **跨设备同步**：通过 WebSocket 实时同步，支持多设备无缝切换
5. **技术架构清晰**：前后端分离，模块化设计，代码可维护性强
6. **完善的文档**：提供详细的架构文档、API 文档、模块文档

---

## 八、运行方式

### 启动应用
```bash
python3 run.py
```

### 访问地址
- 本地：`http://127.0.0.1:5001`
- 局域网：控制台显示的 IP 地址

### 环境要求
- **操作系统**：macOS / Linux
- **Python 版本**：3.7+
- **依赖包**：Flask, flask-cors, flask-socketio, requests

---

## 九、项目价值

1. **实用性强**：解决了语言学习者的实际需求，提供了完整的学习工具链
2. **技术含量高**：涉及前后端开发、数据库设计、缓存优化、实时通信等多个技术领域
3. **扩展性好**：模块化架构便于后续功能扩展（如增加新语言、AI 学习建议等）
4. **用户体验优**：注重细节，动画流畅，交互友好

---

## 十、总结

本项目是一个集词汇管理、听写训练、循环复读于一体的多语言学习平台。通过采用前后端分离架构、四级缓存系统、智能预加载等技术手段，实现了高性能、高可用的 Web 应用。项目不仅具有较高的实用价值，也展示了对现代 Web 开发技术的深入理解和应用能力。

---

**开发者署名**：[你的名字]
**项目时间**：[项目起止时间]
**联系方式**：[你的邮箱]
